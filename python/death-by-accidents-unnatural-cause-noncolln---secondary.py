# John, A, McGregor, J., Jones, I., Lee, S. C., Walters, J. T. R., Owen, M. J., O'Donovan, M., DelPozo-Banos, M., Berridge, D., and Lloyd, K., 2024.

import sys, csv, re

codes = [{"code":"V55.5","system":"icd10"},{"code":"V59.6","system":"icd10"},{"code":"V26.9","system":"icd10"},{"code":"V22","system":"icd10"},{"code":"V23.9","system":"icd10"},{"code":"V66.7","system":"icd10"},{"code":"V24.3","system":"icd10"},{"code":"V69.4","system":"icd10"},{"code":"V54.5","system":"icd10"},{"code":"V54.6","system":"icd10"},{"code":"V75.5","system":"icd10"},{"code":"V44.6","system":"icd10"},{"code":"V50.7","system":"icd10"},{"code":"V55.4","system":"icd10"},{"code":"V45.5","system":"icd10"},{"code":"V72.4","system":"icd10"},{"code":"V02.1","system":"icd10"},{"code":"V42.6","system":"icd10"},{"code":"V12.5","system":"icd10"},{"code":"V53.6","system":"icd10"},{"code":"V63","system":"icd10"},{"code":"V63.7","system":"icd10"},{"code":"V50.6","system":"icd10"},{"code":"V63.4","system":"icd10"},{"code":"V24.5","system":"icd10"},{"code":"V66.6","system":"icd10"},{"code":"V54.9","system":"icd10"},{"code":"V02","system":"icd10"},{"code":"V13.5","system":"icd10"},{"code":"V24","system":"icd10"},{"code":"V69.5","system":"icd10"},{"code":"V65","system":"icd10"},{"code":"V13.9","system":"icd10"},{"code":"V23.4","system":"icd10"},{"code":"V66","system":"icd10"},{"code":"V15","system":"icd10"},{"code":"V43.5","system":"icd10"},{"code":"V45.9","system":"icd10"},{"code":"V75.7","system":"icd10"},{"code":"V45.4","system":"icd10"},{"code":"V60.6","system":"icd10"},{"code":"V15.5","system":"icd10"},{"code":"V14","system":"icd10"},{"code":"V60.5","system":"icd10"},{"code":"V13.4","system":"icd10"},{"code":"V45.7","system":"icd10"},{"code":"V12.4","system":"icd10"},{"code":"V50.4","system":"icd10"},{"code":"V53.7","system":"icd10"},{"code":"V23.5","system":"icd10"},{"code":"V24.9","system":"icd10"},{"code":"V72.7","system":"icd10"},{"code":"V73.4","system":"icd10"},{"code":"V55.7","system":"icd10"},{"code":"V60.4","system":"icd10"},{"code":"V59.4","system":"icd10"},{"code":"V43.6","system":"icd10"},{"code":"V74.5","system":"icd10"},{"code":"V26.4","system":"icd10"},{"code":"V72.9","system":"icd10"},{"code":"V56.7","system":"icd10"},{"code":"V23.3","system":"icd10"},{"code":"V65.7","system":"icd10"},{"code":"V20.5","system":"icd10"},{"code":"V66.5","system":"icd10"},{"code":"V29.5","system":"icd10"},{"code":"V05","system":"icd10"},{"code":"V13","system":"icd10"},{"code":"V66.4","system":"icd10"},{"code":"V60.9","system":"icd10"},{"code":"V56.6","system":"icd10"},{"code":"V63.9","system":"icd10"},{"code":"V42.5","system":"icd10"},{"code":"V45","system":"icd10"},{"code":"V74","system":"icd10"},{"code":"V04","system":"icd10"},{"code":"V44.5","system":"icd10"},{"code":"V29.4","system":"icd10"},{"code":"V73.9","system":"icd10"},{"code":"V26","system":"icd10"},{"code":"V22.4","system":"icd10"},{"code":"V53","system":"icd10"},{"code":"V50.5","system":"icd10"},{"code":"V13.3","system":"icd10"},{"code":"V43.4","system":"icd10"},{"code":"V12.3","system":"icd10"},{"code":"V42.9","system":"icd10"},{"code":"V69.6","system":"icd10"},{"code":"V04.1","system":"icd10"},{"code":"V49.4","system":"icd10"},{"code":"V43","system":"icd10"},{"code":"V66.9","system":"icd10"},{"code":"V65.5","system":"icd10"},{"code":"V14.5","system":"icd10"},{"code":"V44","system":"icd10"},{"code":"V65.9","system":"icd10"},{"code":"V74.6","system":"icd10"},{"code":"V63.6","system":"icd10"},{"code":"V56.4","system":"icd10"},{"code":"V05.1","system":"icd10"},{"code":"V79.4","system":"icd10"},{"code":"V44.4","system":"icd10"},{"code":"V20.9","system":"icd10"},{"code":"V44.9","system":"icd10"},{"code":"V12","system":"icd10"},{"code":"V73.7","system":"icd10"},{"code":"V19.5","system":"icd10"},{"code":"V60","system":"icd10"},{"code":"V55","system":"icd10"},{"code":"V79.5","system":"icd10"},{"code":"V75.6","system":"icd10"},{"code":"V80.5","system":"icd10"},{"code":"V42","system":"icd10"},{"code":"V72.5","system":"icd10"},{"code":"V22.3","system":"icd10"},{"code":"V74.9","system":"icd10"},{"code":"V54","system":"icd10"},{"code":"V20.3","system":"icd10"},{"code":"V56.5","system":"icd10"},{"code":"V42.4","system":"icd10"},{"code":"V22.9","system":"icd10"},{"code":"V55.9","system":"icd10"},{"code":"V14.3","system":"icd10"},{"code":"V25.5","system":"icd10"},{"code":"V80.3","system":"icd10"},{"code":"V63.5","system":"icd10"},{"code":"V43.7","system":"icd10"},{"code":"V53.4","system":"icd10"},{"code":"V74.7","system":"icd10"},{"code":"V26.5","system":"icd10"},{"code":"V56.9","system":"icd10"},{"code":"V42.7","system":"icd10"},{"code":"V55.6","system":"icd10"},{"code":"V50","system":"icd10"},{"code":"V14.4","system":"icd10"},{"code":"V15.3","system":"icd10"},{"code":"V20","system":"icd10"},{"code":"V53.9","system":"icd10"},{"code":"V19.4","system":"icd10"},{"code":"V73.5","system":"icd10"},{"code":"V73","system":"icd10"},{"code":"V23","system":"icd10"},{"code":"V15.4","system":"icd10"},{"code":"V72","system":"icd10"},{"code":"V50.9","system":"icd10"},{"code":"V44.7","system":"icd10"},{"code":"V80.7","system":"icd10"},{"code":"V75","system":"icd10"},{"code":"V25","system":"icd10"},{"code":"V60.7","system":"icd10"},{"code":"V74.4","system":"icd10"},{"code":"V56","system":"icd10"},{"code":"V25.9","system":"icd10"},{"code":"V54.4","system":"icd10"},{"code":"V14.9","system":"icd10"},{"code":"V22.5","system":"icd10"},{"code":"V15.9","system":"icd10"},{"code":"V79.6","system":"icd10"},{"code":"V65.4","system":"icd10"},{"code":"V45.6","system":"icd10"},{"code":"V72.6","system":"icd10"},{"code":"V73.6","system":"icd10"},{"code":"V25.3","system":"icd10"},{"code":"V12.9","system":"icd10"},{"code":"V59.5","system":"icd10"},{"code":"V54.7","system":"icd10"},{"code":"V25.4","system":"icd10"},{"code":"V20.4","system":"icd10"},{"code":"V75.9","system":"icd10"},{"code":"V75.4","system":"icd10"},{"code":"V49.6","system":"icd10"},{"code":"V43.9","system":"icd10"},{"code":"V26.3","system":"icd10"},{"code":"V49.5","system":"icd10"},{"code":"V65.6","system":"icd10"},{"code":"V53.5","system":"icd10"},{"code":"V24.4","system":"icd10"}];
REQUIRED_CODES = 1;
with open(sys.argv[1], 'r') as file_in, open('death-by-accidents-potential-cases.csv', 'w', newline='') as file_out:
    csv_reader = csv.DictReader(file_in)
    csv_writer = csv.DictWriter(file_out, csv_reader.fieldnames + ["death-by-accidents-unnatural-cause-noncolln---secondary-identified"])
    csv_writer.writeheader();
    codes_identified = 0;
    for row in csv_reader:
        newRow = row.copy();
        for cell in row:
            # Iterate cell lists (e.g. codes)
            for item in re.findall(r'\(([^,]*)\,', row[cell]):
                if(item in list(map(lambda code: code['code'], codes))): codes_identified+=1;
                if(codes_identified>=REQUIRED_CODES):
                    newRow["death-by-accidents-unnatural-cause-noncolln---secondary-identified"] = "CASE";
                    break;
            if(codes_identified>=REQUIRED_CODES): break;
        if(codes_identified<REQUIRED_CODES):
            newRow["death-by-accidents-unnatural-cause-noncolln---secondary-identified"] = "UNK";
        codes_identified=0;
        csv_writer.writerow(newRow)
