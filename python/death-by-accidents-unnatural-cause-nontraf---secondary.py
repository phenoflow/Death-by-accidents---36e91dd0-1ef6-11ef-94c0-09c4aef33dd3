# John, A, McGregor, J., Jones, I., Lee, S. C., Walters, J. T. R., Owen, M. J., O'Donovan, M., DelPozo-Banos, M., Berridge, D., and Lloyd, K., 2024.

import sys, csv, re

codes = [{"code":"V62.0","system":"icd10"},{"code":"V43.0","system":"icd10"},{"code":"V73.2","system":"icd10"},{"code":"V42.2","system":"icd10"},{"code":"V39.1","system":"icd10"},{"code":"V45.1","system":"icd10"},{"code":"V69.1","system":"icd10"},{"code":"V30.0","system":"icd10"},{"code":"V06.9","system":"icd10"},{"code":"V75.0","system":"icd10"},{"code":"V60.3","system":"icd10"},{"code":"V36.2","system":"icd10"},{"code":"V72.0","system":"icd10"},{"code":"V63.3","system":"icd10"},{"code":"V20.1","system":"icd10"},{"code":"V26.0","system":"icd10"},{"code":"V79.0","system":"icd10"},{"code":"V55.3","system":"icd10"},{"code":"V56.0","system":"icd10"},{"code":"V40.0","system":"icd10"},{"code":"V53.0","system":"icd10"},{"code":"V73.0","system":"icd10"},{"code":"V34.2","system":"icd10"},{"code":"V69.2","system":"icd10"},{"code":"V35.0","system":"icd10"},{"code":"V30.1","system":"icd10"},{"code":"V10.2","system":"icd10"},{"code":"V04.9","system":"icd10"},{"code":"V52.3","system":"icd10"},{"code":"V26.2","system":"icd10"},{"code":"V20.0","system":"icd10"},{"code":"V70.3","system":"icd10"},{"code":"V45.2","system":"icd10"},{"code":"V88","system":"icd10"},{"code":"V10.1","system":"icd10"},{"code":"V29.1","system":"icd10"},{"code":"V60.0","system":"icd10"},{"code":"V35.1","system":"icd10"},{"code":"V30.2","system":"icd10"},{"code":"V79.3","system":"icd10"},{"code":"V60.2","system":"icd10"},{"code":"V24.1","system":"icd10"},{"code":"V16.2","system":"icd10"},{"code":"V24.0","system":"icd10"},{"code":"V44.2","system":"icd10"},{"code":"V32.1","system":"icd10"},{"code":"V12.2","system":"icd10"},{"code":"V74.0","system":"icd10"},{"code":"V36.0","system":"icd10"},{"code":"V75.2","system":"icd10"},{"code":"V36.3","system":"icd10"},{"code":"V29.0","system":"icd10"},{"code":"V76.1","system":"icd10"},{"code":"V32.2","system":"icd10"},{"code":"V04.0","system":"icd10"},{"code":"V75.3","system":"icd10"},{"code":"V14.0","system":"icd10"},{"code":"V49.0","system":"icd10"},{"code":"V40.2","system":"icd10"},{"code":"V23.1","system":"icd10"},{"code":"V46.0","system":"icd10"},{"code":"V06.0","system":"icd10"},{"code":"V74.1","system":"icd10"},{"code":"V25.2","system":"icd10"},{"code":"V13.2","system":"icd10"},{"code":"V49.2","system":"icd10"},{"code":"V05.0","system":"icd10"},{"code":"V46.1","system":"icd10"},{"code":"V63.1","system":"icd10"},{"code":"V09.0","system":"icd10"},{"code":"V50.3","system":"icd10"},{"code":"V69.0","system":"icd10"},{"code":"V53.1","system":"icd10"},{"code":"V65.1","system":"icd10"},{"code":"V59.1","system":"icd10"},{"code":"V23.2","system":"icd10"},{"code":"V54.3","system":"icd10"},{"code":"V44.3","system":"icd10"},{"code":"V44.1","system":"icd10"},{"code":"V13.1","system":"icd10"},{"code":"V74.2","system":"icd10"},{"code":"V33.1","system":"icd10"},{"code":"V59.2","system":"icd10"},{"code":"V72.3","system":"icd10"},{"code":"V43.1","system":"icd10"},{"code":"V62.1","system":"icd10"},{"code":"V39.2","system":"icd10"},{"code":"V55.2","system":"icd10"},{"code":"V23.0","system":"icd10"},{"code":"V70.0","system":"icd10"},{"code":"V29.3","system":"icd10"},{"code":"V09.1","system":"icd10"},{"code":"V34.1","system":"icd10"},{"code":"V50.2","system":"icd10"},{"code":"V32.0","system":"icd10"},{"code":"V03.9","system":"icd10"},{"code":"V14.1","system":"icd10"},{"code":"V72.1","system":"icd10"},{"code":"V66.2","system":"icd10"},{"code":"V66.3","system":"icd10"},{"code":"V35.3","system":"icd10"},{"code":"V12.0","system":"icd10"},{"code":"V49.1","system":"icd10"},{"code":"V54.1","system":"icd10"},{"code":"V52.0","system":"icd10"},{"code":"V59.0","system":"icd10"},{"code":"V25.1","system":"icd10"},{"code":"V66.1","system":"icd10"},{"code":"V65.2","system":"icd10"},{"code":"V76.2","system":"icd10"},{"code":"V42.3","system":"icd10"},{"code":"V40.3","system":"icd10"},{"code":"V22.0","system":"icd10"},{"code":"V79.2","system":"icd10"},{"code":"V34.3","system":"icd10"},{"code":"V15.2","system":"icd10"},{"code":"V73.1","system":"icd10"},{"code":"V20.2","system":"icd10"},{"code":"V43.3","system":"icd10"},{"code":"V88.0","system":"icd10"},{"code":"V33.3","system":"icd10"},{"code":"V63.0","system":"icd10"},{"code":"V02.9","system":"icd10"},{"code":"V55.1","system":"icd10"},{"code":"V88.3","system":"icd10"},{"code":"V62.3","system":"icd10"},{"code":"V53.3","system":"icd10"},{"code":"V54.0","system":"icd10"},{"code":"V74.3","system":"icd10"},{"code":"V19.0","system":"icd10"},{"code":"V54.2","system":"icd10"},{"code":"V02.0","system":"icd10"},{"code":"V34.0","system":"icd10"},{"code":"V42.0","system":"icd10"},{"code":"V22.2","system":"icd10"},{"code":"V05.9","system":"icd10"},{"code":"V43.2","system":"icd10"},{"code":"V45.3","system":"icd10"},{"code":"V13.0","system":"icd10"},{"code":"V35.2","system":"icd10"},{"code":"V70.2","system":"icd10"},{"code":"V39.3","system":"icd10"},{"code":"V52.1","system":"icd10"},{"code":"V56.2","system":"icd10"},{"code":"V53.2","system":"icd10"},{"code":"V30.3","system":"icd10"},{"code":"V76.0","system":"icd10"},{"code":"V16.1","system":"icd10"},{"code":"V66.0","system":"icd10"},{"code":"V63.2","system":"icd10"},{"code":"V81.0","system":"icd10"},{"code":"V36.1","system":"icd10"},{"code":"V59.3","system":"icd10"},{"code":"V73.3","system":"icd10"},{"code":"V40.1","system":"icd10"},{"code":"V33.0","system":"icd10"},{"code":"V16.0","system":"icd10"},{"code":"V12.1","system":"icd10"},{"code":"V75.1","system":"icd10"},{"code":"V55.0","system":"icd10"},{"code":"V33.2","system":"icd10"},{"code":"V45.0","system":"icd10"},{"code":"V15.1","system":"icd10"},{"code":"V65.0","system":"icd10"},{"code":"V72.2","system":"icd10"},{"code":"V79.1","system":"icd10"},{"code":"V76.3","system":"icd10"},{"code":"V03.0","system":"icd10"},{"code":"V49.3","system":"icd10"},{"code":"V26.1","system":"icd10"},{"code":"V56.1","system":"icd10"},{"code":"V19.3","system":"icd10"},{"code":"V19.1","system":"icd10"},{"code":"V56.3","system":"icd10"},{"code":"V50.1","system":"icd10"},{"code":"V15.0","system":"icd10"},{"code":"V10.0","system":"icd10"},{"code":"V22.1","system":"icd10"},{"code":"V42.1","system":"icd10"},{"code":"V46.2","system":"icd10"},{"code":"V39.0","system":"icd10"},{"code":"V50.0","system":"icd10"},{"code":"V25.0","system":"icd10"},{"code":"V14.2","system":"icd10"},{"code":"V52.2","system":"icd10"},{"code":"V65.3","system":"icd10"},{"code":"V24.2","system":"icd10"},{"code":"V44.0","system":"icd10"},{"code":"V70.1","system":"icd10"},{"code":"V69.3","system":"icd10"},{"code":"V32.3","system":"icd10"},{"code":"V60.1","system":"icd10"},{"code":"V62.2","system":"icd10"},{"code":"V46.3","system":"icd10"}];
REQUIRED_CODES = 1;
with open(sys.argv[1], 'r') as file_in, open('death-by-accidents-potential-cases.csv', 'w', newline='') as file_out:
    csv_reader = csv.DictReader(file_in)
    csv_writer = csv.DictWriter(file_out, csv_reader.fieldnames + ["death-by-accidents-unnatural-cause-nontraf---secondary-identified"])
    csv_writer.writeheader();
    codes_identified = 0;
    for row in csv_reader:
        newRow = row.copy();
        for cell in row:
            # Iterate cell lists (e.g. codes)
            for item in re.findall(r'\(([^,]*)\,', row[cell]):
                if(item in list(map(lambda code: code['code'], codes))): codes_identified+=1;
                if(codes_identified>=REQUIRED_CODES):
                    newRow["death-by-accidents-unnatural-cause-nontraf---secondary-identified"] = "CASE";
                    break;
            if(codes_identified>=REQUIRED_CODES): break;
        if(codes_identified<REQUIRED_CODES):
            newRow["death-by-accidents-unnatural-cause-nontraf---secondary-identified"] = "UNK";
        codes_identified=0;
        csv_writer.writerow(newRow)
