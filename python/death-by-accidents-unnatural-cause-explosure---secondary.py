# John, A, McGregor, J., Jones, I., Lee, S. C., Walters, J. T. R., Owen, M. J., O'Donovan, M., DelPozo-Banos, M., Berridge, D., and Lloyd, K., 2024.

import sys, csv, re

codes = [{"code":"W49.5","system":"icd10"},{"code":"X30.5","system":"icd10"},{"code":"W64.5","system":"icd10"},{"code":"X48.1","system":"icd10"},{"code":"X59.4","system":"icd10"},{"code":"X31.1","system":"icd10"},{"code":"X01.2","system":"icd10"},{"code":"X06.7","system":"icd10"},{"code":"X31","system":"icd10"},{"code":"W86.4","system":"icd10"},{"code":"X09.9","system":"icd10"},{"code":"X02.1","system":"icd10"},{"code":"X05.7","system":"icd10"},{"code":"X01.8","system":"icd10"},{"code":"W87.2","system":"icd10"},{"code":"X58.4","system":"icd10"},{"code":"W43.8","system":"icd10"},{"code":"W41.5","system":"icd10"},{"code":"X09.0","system":"icd10"},{"code":"W91.2","system":"icd10"},{"code":"X39.8","system":"icd10"},{"code":"X04.9","system":"icd10"},{"code":"W43.4","system":"icd10"},{"code":"W49.2","system":"icd10"},{"code":"W43.5","system":"icd10"},{"code":"W41.0","system":"icd10"},{"code":"W42.1","system":"icd10"},{"code":"W92","system":"icd10"},{"code":"W90.8","system":"icd10"},{"code":"W91.0","system":"icd10"},{"code":"X02.0","system":"icd10"},{"code":"X49.7","system":"icd10"},{"code":"W91.9","system":"icd10"},{"code":"W88.8","system":"icd10"},{"code":"X45.1","system":"icd10"},{"code":"X39.1","system":"icd10"},{"code":"W88","system":"icd10"},{"code":"X39.2","system":"icd10"},{"code":"X02.5","system":"icd10"},{"code":"X49.9","system":"icd10"},{"code":"X05.5","system":"icd10"},{"code":"X58.2","system":"icd10"},{"code":"X31.7","system":"icd10"},{"code":"X31.5","system":"icd10"},{"code":"X45.5","system":"icd10"},{"code":"X48.4","system":"icd10"},{"code":"X08.4","system":"icd10"},{"code":"X58.1","system":"icd10"},{"code":"W92.9","system":"icd10"},{"code":"W49.4","system":"icd10"},{"code":"X06.5","system":"icd10"},{"code":"X00.1","system":"icd10"},{"code":"X00.4","system":"icd10"},{"code":"W93.7","system":"icd10"},{"code":"X31.0","system":"icd10"},{"code":"X47","system":"icd10"},{"code":"X39.0","system":"icd10"},{"code":"X08.2","system":"icd10"},{"code":"W64.4","system":"icd10"},{"code":"W85.2","system":"icd10"},{"code":"X49.1","system":"icd10"},{"code":"W90.4","system":"icd10"},{"code":"X45.4","system":"icd10"},{"code":"X32","system":"icd10"},{"code":"X00.9","system":"icd10"},{"code":"W89.8","system":"icd10"},{"code":"X49.0","system":"icd10"},{"code":"X49.2","system":"icd10"},{"code":"X47.7","system":"icd10"},{"code":"X31.8","system":"icd10"},{"code":"W85","system":"icd10"},{"code":"X47.0","system":"icd10"},{"code":"W89.0","system":"icd10"},{"code":"X59.0","system":"icd10"},{"code":"W41.4","system":"icd10"},{"code":"X03.2","system":"icd10"},{"code":"X58.7","system":"icd10"},{"code":"X39.9","system":"icd10"},{"code":"X39.7","system":"icd10"},{"code":"X01","system":"icd10"},{"code":"W64.2","system":"icd10"},{"code":"X45.0","system":"icd10"},{"code":"X32.7","system":"icd10"},{"code":"W90.7","system":"icd10"},{"code":"W85.7","system":"icd10"},{"code":"W49.8","system":"icd10"},{"code":"W90","system":"icd10"},{"code":"X04.0","system":"icd10"},{"code":"X06.8","system":"icd10"},{"code":"W64.9","system":"icd10"},{"code":"X05.8","system":"icd10"},{"code":"X08.7","system":"icd10"},{"code":"X02.4","system":"icd10"},{"code":"X09","system":"icd10"},{"code":"W91.1","system":"icd10"},{"code":"X03.9","system":"icd10"},{"code":"W85.1","system":"icd10"},{"code":"X00","system":"icd10"},{"code":"W43.7","system":"icd10"},{"code":"X59.1","system":"icd10"},{"code":"W93","system":"icd10"},{"code":"W93.4","system":"icd10"},{"code":"X48.7","system":"icd10"},{"code":"W99.7","system":"icd10"},{"code":"W41.8","system":"icd10"},{"code":"W91.8","system":"icd10"},{"code":"X03.7","system":"icd10"},{"code":"X59.8","system":"icd10"},{"code":"W86","system":"icd10"},{"code":"W88.2","system":"icd10"},{"code":"X03.1","system":"icd10"},{"code":"W89.2","system":"icd10"},{"code":"W42.7","system":"icd10"},{"code":"X30.4","system":"icd10"},{"code":"X47.1","system":"icd10"},{"code":"X06.4","system":"icd10"},{"code":"W88.9","system":"icd10"},{"code":"X47.5","system":"icd10"},{"code":"W89.4","system":"icd10"},{"code":"W91.5","system":"icd10"},{"code":"X05.4","system":"icd10"},{"code":"W41","system":"icd10"},{"code":"X03","system":"icd10"},{"code":"X32.1","system":"icd10"},{"code":"W88.4","system":"icd10"},{"code":"X00.8","system":"icd10"},{"code":"X06","system":"icd10"},{"code":"W43.0","system":"icd10"},{"code":"W87.9","system":"icd10"},{"code":"X04.1","system":"icd10"},{"code":"W90.1","system":"icd10"},{"code":"X01.7","system":"icd10"},{"code":"X59.2","system":"icd10"},{"code":"W99.9","system":"icd10"},{"code":"W87.5","system":"icd10"},{"code":"X48.9","system":"icd10"},{"code":"W87.4","system":"icd10"},{"code":"X06.0","system":"icd10"},{"code":"X58.9","system":"icd10"},{"code":"X08.5","system":"icd10"},{"code":"W42.0","system":"icd10"},{"code":"W89.7","system":"icd10"},{"code":"X08.8","system":"icd10"},{"code":"W93.0","system":"icd10"},{"code":"X05.2","system":"icd10"},{"code":"X06.9","system":"icd10"},{"code":"W64.1","system":"icd10"},{"code":"X02.7","system":"icd10"},{"code":"W49","system":"icd10"},{"code":"W88.5","system":"icd10"},{"code":"W41.1","system":"icd10"},{"code":"W87.1","system":"icd10"},{"code":"W88.0","system":"icd10"},{"code":"W85.0","system":"icd10"},{"code":"W92.8","system":"icd10"},{"code":"X02","system":"icd10"},{"code":"W88.1","system":"icd10"},{"code":"X49.4","system":"icd10"},{"code":"W99.1","system":"icd10"},{"code":"W49.9","system":"icd10"},{"code":"W99.0","system":"icd10"},{"code":"W42.4","system":"icd10"},{"code":"W49.1","system":"icd10"},{"code":"X30.1","system":"icd10"},{"code":"X58","system":"icd10"},{"code":"X01.4","system":"icd10"},{"code":"X05.0","system":"icd10"},{"code":"X45","system":"icd10"},{"code":"X03.5","system":"icd10"},{"code":"X04","system":"icd10"},{"code":"W93.8","system":"icd10"},{"code":"W41.9","system":"icd10"},{"code":"X47.2","system":"icd10"},{"code":"X06.1","system":"icd10"},{"code":"X39.4","system":"icd10"},{"code":"W99.5","system":"icd10"},{"code":"X49.8","system":"icd10"},{"code":"W91.4","system":"icd10"},{"code":"X04.5","system":"icd10"},{"code":"X09.1","system":"icd10"},{"code":"W89.9","system":"icd10"},{"code":"X32.2","system":"icd10"},{"code":"W87.8","system":"icd10"},{"code":"W87.7","system":"icd10"},{"code":"X31.9","system":"icd10"},{"code":"W86.0","system":"icd10"},{"code":"W93.1","system":"icd10"},{"code":"X08.1","system":"icd10"},{"code":"W85.5","system":"icd10"},{"code":"W93.9","system":"icd10"},{"code":"X01.5","system":"icd10"},{"code":"X32.9","system":"icd10"},{"code":"W43.2","system":"icd10"},{"code":"X30.2","system":"icd10"},{"code":"W42.9","system":"icd10"},{"code":"W92.5","system":"icd10"},{"code":"X59.7","system":"icd10"},{"code":"X45.7","system":"icd10"},{"code":"X08.0","system":"icd10"},{"code":"W93.5","system":"icd10"},{"code":"W99","system":"icd10"},{"code":"X39","system":"icd10"},{"code":"W49.7","system":"icd10"},{"code":"X32.5","system":"icd10"},{"code":"X04.2","system":"icd10"},{"code":"X59","system":"icd10"},{"code":"X03.8","system":"icd10"},{"code":"X45.2","system":"icd10"},{"code":"X09.8","system":"icd10"},{"code":"W64.7","system":"icd10"},{"code":"W87","system":"icd10"},{"code":"W43","system":"icd10"},{"code":"W92.4","system":"icd10"},{"code":"W41.2","system":"icd10"},{"code":"W42","system":"icd10"},{"code":"W99.8","system":"icd10"},{"code":"X48.2","system":"icd10"},{"code":"W88.7","system":"icd10"},{"code":"W43.9","system":"icd10"},{"code":"W90.2","system":"icd10"},{"code":"W89.1","system":"icd10"},{"code":"X04.7","system":"icd10"},{"code":"X02.8","system":"icd10"},{"code":"X47.9","system":"icd10"},{"code":"X03.0","system":"icd10"},{"code":"X00.2","system":"icd10"},{"code":"X32.8","system":"icd10"},{"code":"W86.8","system":"icd10"},{"code":"W99.2","system":"icd10"},{"code":"X30.8","system":"icd10"},{"code":"X00.5","system":"icd10"},{"code":"W93.2","system":"icd10"},{"code":"X05.9","system":"icd10"},{"code":"X09.4","system":"icd10"},{"code":"W91","system":"icd10"},{"code":"X32.4","system":"icd10"},{"code":"W90.0","system":"icd10"},{"code":"X32.0","system":"icd10"},{"code":"X45.8","system":"icd10"},{"code":"X02.2","system":"icd10"},{"code":"W85.9","system":"icd10"},{"code":"W89","system":"icd10"},{"code":"W42.5","system":"icd10"},{"code":"W42.8","system":"icd10"},{"code":"W91.7","system":"icd10"},{"code":"W99.4","system":"icd10"},{"code":"W86.1","system":"icd10"},{"code":"X01.1","system":"icd10"},{"code":"X30.9","system":"icd10"},{"code":"X01.0","system":"icd10"},{"code":"X05","system":"icd10"},{"code":"W92.2","system":"icd10"},{"code":"X30.7","system":"icd10"},{"code":"W64","system":"icd10"},{"code":"X09.2","system":"icd10"},{"code":"W43.1","system":"icd10"},{"code":"W42.2","system":"icd10"},{"code":"W49.0","system":"icd10"},{"code":"W87.0","system":"icd10"},{"code":"W86.2","system":"icd10"},{"code":"X47.4","system":"icd10"},{"code":"X48.0","system":"icd10"},{"code":"W41.7","system":"icd10"},{"code":"X01.9","system":"icd10"},{"code":"X48.5","system":"icd10"},{"code":"X30","system":"icd10"},{"code":"X04.4","system":"icd10"},{"code":"X06.2","system":"icd10"},{"code":"X31.4","system":"icd10"},{"code":"X08.9","system":"icd10"},{"code":"X31.2","system":"icd10"},{"code":"X04.8","system":"icd10"},{"code":"X30.0","system":"icd10"},{"code":"W64.8","system":"icd10"},{"code":"X58.5","system":"icd10"},{"code":"W85.8","system":"icd10"},{"code":"X59.5","system":"icd10"},{"code":"X49.5","system":"icd10"},{"code":"X58.8","system":"icd10"},{"code":"W89.5","system":"icd10"},{"code":"X59.9","system":"icd10"},{"code":"W90.5","system":"icd10"},{"code":"X09.5","system":"icd10"},{"code":"W92.7","system":"icd10"},{"code":"X47.8","system":"icd10"},{"code":"W85.4","system":"icd10"},{"code":"X03.4","system":"icd10"},{"code":"X00.7","system":"icd10"},{"code":"W64.0","system":"icd10"},{"code":"W86.9","system":"icd10"},{"code":"X58.0","system":"icd10"},{"code":"X09.7","system":"icd10"},{"code":"X08","system":"icd10"},{"code":"X48.8","system":"icd10"},{"code":"X45.9","system":"icd10"},{"code":"X02.9","system":"icd10"},{"code":"W86.5","system":"icd10"},{"code":"X39.5","system":"icd10"},{"code":"W92.1","system":"icd10"},{"code":"W86.7","system":"icd10"},{"code":"W92.0","system":"icd10"},{"code":"W90.9","system":"icd10"},{"code":"X00.0","system":"icd10"},{"code":"X05.1","system":"icd10"},{"code":"X48","system":"icd10"},{"code":"X49","system":"icd10"}];
REQUIRED_CODES = 1;
with open(sys.argv[1], 'r') as file_in, open('death-by-accidents-potential-cases.csv', 'w', newline='') as file_out:
    csv_reader = csv.DictReader(file_in)
    csv_writer = csv.DictWriter(file_out, csv_reader.fieldnames + ["death-by-accidents-unnatural-cause-explosure---secondary-identified"])
    csv_writer.writeheader();
    codes_identified = 0;
    for row in csv_reader:
        newRow = row.copy();
        for cell in row:
            # Iterate cell lists (e.g. codes)
            for item in re.findall(r'\(([^,]*)\,', row[cell]):
                if(item in list(map(lambda code: code['code'], codes))): codes_identified+=1;
                if(codes_identified>=REQUIRED_CODES):
                    newRow["death-by-accidents-unnatural-cause-explosure---secondary-identified"] = "CASE";
                    break;
            if(codes_identified>=REQUIRED_CODES): break;
        if(codes_identified<REQUIRED_CODES):
            newRow["death-by-accidents-unnatural-cause-explosure---secondary-identified"] = "UNK";
        codes_identified=0;
        csv_writer.writerow(newRow)
